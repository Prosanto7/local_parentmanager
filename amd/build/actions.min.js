/**
 * JavaScript for Parent Manager plugin actions.
 *
 * @module     local_parentmanager/actions
 * @copyright  2026
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_parentmanager/actions",["jquery","core/ajax","core/notification","core/modal","core/modal_save_cancel","core/modal_events","core/str","core/fragment"],(function($,Ajax,Notification,Modal,ModalSaveCancel,ModalEvents,Str,Fragment){var viewChildren=function(parentId,parentName){Str.get_strings([{key:"assignedchildrenforparent",component:"local_parentmanager"},{key:"nochildren",component:"local_parentmanager"},{key:"remove",component:"core"},{key:"close",component:"core"}]).done((function(strings){Ajax.call([{methodname:"local_parentmanager_get_children",args:{parentid:parentId}}])[0].done((function(response){var body='<div class="parent-children-list">';0===response.children.length?body+="<p>"+strings[1]+"</p>":(body+='<table class="table table-striped">',body+="<thead><tr><th>Name</th><th>Email</th><th>Actions</th></tr></thead>",body+="<tbody>",response.children.forEach((function(child){body+="<tr>",body+='<td><a href="'+child.profileurl+'" target="_blank">'+child.fullname+"</a></td>",body+="<td>"+child.email+"</td>",body+='<td><button class="btn btn-sm btn-danger" data-action="remove-child" data-relationid="'+child.relationid+'">'+strings[2]+"</button></td>",body+="</tr>"})),body+="</tbody></table>"),body+="</div>",Modal.create({title:strings[0]+": "+parentName,body:body,show:!0,removeOnClose:!0,large:!0}).then((function(modal){modal.getRoot().on("click",'[data-action="remove-child"]',(function(e){e.preventDefault();var relationId=$(this).data("relationid");removeChild(relationId,modal)}))}))})).fail(Notification.exception)}))},removeChild=function(relationId){Str.get_strings([{key:"confirm",component:"core"},{key:"confirmremovechild",component:"local_parentmanager"},{key:"yes",component:"core"},{key:"no",component:"core"},{key:"childremoved",component:"local_parentmanager"}]).done((function(strings){Notification.confirm(strings[0],strings[1],strings[2],strings[3],(function(){Ajax.call([{methodname:"local_parentmanager_remove_child",args:{relationid:relationId}}])[0].done((function(response){response.success&&window.location.reload()})).fail(Notification.exception)}))}))},assignChild=function(parentId,parentName){Str.get_strings([{key:"assignchild",component:"local_parentmanager"},{key:"assign",component:"local_parentmanager"},{key:"childrenassigned",component:"local_parentmanager"}]).done((function(strings){var formPromise=Fragment.loadFragment("local_parentmanager","assign_form",1,{parentid:parentId});ModalSaveCancel.create({title:strings[0]+": "+parentName,body:formPromise,show:!0,removeOnClose:!0,large:!0}).then((function(modal){modal.setSaveButtonText(strings[1]),modal.getRoot().on(ModalEvents.save,(function(e){e.preventDefault();var selectedIds=modal.getRoot().find("form").find('[name="childuserids[]"]').val();selectedIds&&0!==selectedIds.length?(selectedIds=selectedIds.map((function(id){return parseInt(id)})),Ajax.call([{methodname:"local_parentmanager_assign_children",args:{parentid:parentId,childids:selectedIds}}])[0].done((function(response){response.success&&(modal.hide(),window.location.reload())})).fail(Notification.exception)):Str.get_string("noselectederror","local_parentmanager").done((function(errorMsg){Notification.addNotification({message:errorMsg,type:"warning"})}))}))}))}))},removeParent=function(parentId,parentName){Str.get_strings([{key:"confirm",component:"core"},{key:"confirmremoveparent",component:"local_parentmanager"},{key:"yes",component:"core"},{key:"no",component:"core"},{key:"parentremoved",component:"local_parentmanager"}]).done((function(strings){var confirmMessage=strings[1].replace("{$a}",parentName);Notification.confirm(strings[0],confirmMessage,strings[2],strings[3],(function(){Ajax.call([{methodname:"local_parentmanager_remove_parent",args:{parentid:parentId}}])[0].done((function(response){response.success&&window.location.reload()})).fail(Notification.exception)}))}))};return{init:function(){$(document).on("click",'[data-action="view-children"]',(function(e){e.preventDefault();var parentId=$(this).data("parentid"),parentName=$(this).data("parentname");viewChildren(parentId,parentName)})),$(document).on("click",'[data-action="assign-child"]',(function(e){e.preventDefault();var parentId=$(this).data("parentid"),parentName=$(this).data("parentname");assignChild(parentId,parentName)})),$(document).on("click",'[data-action="remove-parent"]',(function(e){e.preventDefault();var parentId=$(this).data("parentid"),parentName=$(this).data("parentname");removeParent(parentId,parentName)}))}}}));

//# sourceMappingURL=actions.min.js.map